---
import ArticleLayout from "@/layouts/ArticleLayout.astro";

import { type CollectionEntry, getCollection, render } from "astro:content";
import { sortItemsByDateDesc } from "@/lib/article";
import { toSlug } from "@/lib/utils";

export async function getStaticPaths() {
  const articles = (await getCollection("article")).sort(sortItemsByDateDesc);

  return articles.map((article: CollectionEntry<"article">, index: number) => ({
    params: {
      slug: toSlug(article.data.title),
      desc: article.data.description ?? "Description",
      title: article.data.title ?? "Title",
    },
    props: {
      article,
      prevArticle: index + 1 !== articles.length ? articles[index + 1] : null,
      nextArticle: index !== 0 ? articles[index - 1] : null,
    },
  }));
}

type Props = {
  article: CollectionEntry<"article">;
  prevArticle: CollectionEntry<"article"> | null;
  nextArticle: CollectionEntry<"article"> | null;
};

const { slug } = Astro.params;
const { article } = Astro.props;
const { title, description, pubDate } = article.data;

const { Content, remarkPluginFrontmatter } = await render(article);
---

<ArticleLayout
  description={description}
  minutesRead={remarkPluginFrontmatter.minutesRead}
  pubDate={pubDate}
  title={title}
  slug={slug}
>
  <Content />
</ArticleLayout>
